#!/bin/sh -e

{
    cd pybind11

    unset DESTDIR

    python setup.py build
    python setup.py install \
        --root="$PWD/dist" \
        --skip-build \
        --optimize='1'

    cd dist/usr/lib/python*/site-packages

    PYTHONPATH=$PWD:$(python -c "import sys; print(':'.join(sys.path))")

    cd -; cd ..
}

export PYTHONPATH

sed -i '/<vector>/a #include <stdint.h>' \
    scipy/optimize/rectangular_lsap/rectangular_lsap.cpp

export SCIPY_USE_PYTHRAN=0
python setup.py config_fc --fcompiler=gnu95 build
python setup.py install \
    --prefix=/usr \
    --root="$1" \
    --optimize=1
